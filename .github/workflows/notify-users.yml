# .github/workflows/notify-stargazers.yml  ? COPIA QUESTO ESATTO
name: Notify Stargazers on Push
on: [push]  # O schedule per meno spam

jobs:
  ping:
    runs-on: ubuntu-latest
    permissions:
      issues: write  # Fix permessi
    steps:
    - name: Fetch Stargazers & Post Comment
      uses: actions/github-script@v7
      with:
        script: |
          // Lista primi 5 stargazers
          const stargazers = await github.rest.activity.listStargazersForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo,
            per_page: 5
          });
          
          const users = stargazers.data.map(u => `@${u.login}`).join(' ');
          
          // Crea/Commenta Issue esistente (ID 1 o crea nuovo)
          const issue = await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: '?? Stargazers: Live Tennis Stats Site!',
            body: `Ciao community!\n\nStats live da TML-Database: https://stats.tennismylife.org/\n\n**Linkalo nei tuoi progetti!**\n\n${users}\n\n#tennis #stats #TML`,
            labels: ['promotion']
          });
          
          console.log('Issue creata:', issue.data.html_url);